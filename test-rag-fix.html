<!DOCTYPE html>
<html>
<head>
    <title>Test RAG Fix</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .result { margin: 10px 0; padding: 10px; background: #f5f5f5; }
        button { margin: 5px; padding: 8px 16px; }
        input { margin: 5px; padding: 8px; width: 300px; }
    </style>
</head>
<body>
    <h1>Test RAG System Fix</h1>
    
    <div class="test-section">
        <h3>API Key Setup</h3>
        <input type="password" id="apiKey" placeholder="Enter OpenAI API key (sk-...)">
        <button onclick="setApiKey()">Set API Key</button>
        <div id="apiStatus" class="result">No API key set</div>
    </div>

    <div class="test-section">
        <h3>Test Large Context Processing</h3>
        <button onclick="testProcessing()">Test RAG Processing</button>
        <div id="processingResult" class="result">Click to test</div>
    </div>

    <div class="test-section">
        <h3>Test Search</h3>
        <input type="text" id="searchQuery" placeholder="Enter search query" value="what is machine learning?">
        <button onclick="testSearch()">Search</button>
        <div id="searchResult" class="result">No search performed</div>
    </div>

    <script src="rag-system.js"></script>
    <script>
        let ragSystem = null;

        async function initRAG() {
            if (!ragSystem) {
                ragSystem = new RAGSystem();
                await ragSystem.initialize();
                console.log('RAG System initialized');
            }
            return ragSystem;
        }

        async function setApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                document.getElementById('apiStatus').textContent = 'Please enter an API key';
                return;
            }

            try {
                await initRAG();
                await ragSystem.setOpenAIKey(apiKey);
                document.getElementById('apiStatus').textContent = '✓ API key set successfully';
                document.getElementById('apiKey').value = '';
            } catch (error) {
                document.getElementById('apiStatus').textContent = '❌ Failed to set API key: ' + error.message;
            }
        }

        async function testProcessing() {
            try {
                document.getElementById('processingResult').textContent = 'Processing...';
                
                await initRAG();
                
                // Test text (about 31k characters like in your case)
                const testText = `Machine Learning, Plain and Spiky Machine learning (ML) is the craft of turning data into behavior. It's less about building perfect minds and more about making reliable guesses under uncertainty. The glamorous parts—neural networks, kernels, transformers—are just different ways to do three things: find patterns, make predictions, and optimize decisions.

At its core, ML is pattern recognition on steroids. You feed it examples (data), and it learns to spot similarities and differences. Think of it as teaching a computer to recognize cats by showing it thousands of cat photos, except instead of cats, it might be learning to predict stock prices, recommend movies, or detect spam.

The "learning" happens through algorithms that adjust themselves based on feedback. When the system makes a mistake, it tweaks its internal parameters to do better next time. It's like learning to ride a bike—you fall, adjust, fall less, adjust more, until eventually you're cruising.

There are three main flavors: supervised learning (learning with a teacher who provides the right answers), unsupervised learning (finding hidden patterns without guidance), and reinforcement learning (learning through trial and error with rewards and punishments).

The real magic isn't in the algorithms themselves—it's in the data. Good data can make a simple algorithm shine, while bad data can cripple the most sophisticated model. It's garbage in, garbage out, but with mathematical precision.

Modern ML has exploded because we finally have three things that were missing before: massive amounts of data (thanks, internet), powerful computers (hello, GPUs), and clever algorithms that can handle both.

The applications are everywhere: your phone's camera recognizing faces, Netflix suggesting what to binge next, your email filtering spam, cars learning to drive themselves, and doctors getting help diagnosing diseases. It's not magic—it's math, statistics, and a lot of computational brute force.

But here's the thing: ML systems are only as good as their training data and the problems they're designed to solve. They can be biased, brittle, and sometimes confidently wrong. They're powerful tools, not crystal balls.

The field moves fast. What was cutting-edge five years ago is now a weekend tutorial. New architectures, techniques, and applications emerge constantly. It's exciting and exhausting in equal measure.

For practitioners, it's part art, part science. You need to understand the math, wrangle the data, tune the models, and somehow make it all work in the real world where data is messy and requirements change daily.

The future? More integration into everyday life, better tools for non-experts, and hopefully more focus on making these systems fair, transparent, and beneficial for everyone. But that's the optimistic view—we'll see how it actually plays out.`.repeat(10); // Make it large enough

                const contextId = 'test_context_' + Date.now();
                const tagId = 'test_tag_123';
                
                console.log(`Testing with ${testText.length} characters`);
                
                // Process the large context
                await ragSystem.processLargeContext(testText, contextId, tagId);
                
                document.getElementById('processingResult').textContent = `✓ Successfully processed ${testText.length} characters into chunks`;
                
            } catch (error) {
                console.error('Processing failed:', error);
                document.getElementById('processingResult').textContent = '❌ Processing failed: ' + error.message;
            }
        }

        async function testSearch() {
            try {
                document.getElementById('searchResult').textContent = 'Searching...';
                
                await initRAG();
                
                const query = document.getElementById('searchQuery').value.trim();
                if (!query) {
                    document.getElementById('searchResult').textContent = 'Please enter a search query';
                    return;
                }
                
                // Search for relevant chunks
                const results = await ragSystem.searchChunks(query, 'test_tag_123', 3);
                
                if (results && results.length > 0) {
                    let resultText = `✓ Found ${results.length} relevant chunks:\n\n`;
                    results.forEach((result, i) => {
                        resultText += `${i + 1}. Similarity: ${result.score.toFixed(3)}\n`;
                        resultText += `Text: ${result.chunk.text.substring(0, 200)}...\n\n`;
                    });
                    document.getElementById('searchResult').textContent = resultText;
                } else {
                    document.getElementById('searchResult').textContent = '❌ No relevant chunks found';
                }
                
            } catch (error) {
                console.error('Search failed:', error);
                document.getElementById('searchResult').textContent = '❌ Search failed: ' + error.message;
            }
        }
    </script>
</body>
</html>
